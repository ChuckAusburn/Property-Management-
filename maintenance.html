<!DOCTYPE html>
<html>

<head>
  <title>Property-Management-Maintenance-Form`</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Linking CSS Reset File -->
  <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous">
</head>

<body>
  <div class="parentheader">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">EZIE ISAAC PROPERTIES</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav ml-auto">
          <a class="nav-item nav-link " href="request.html">Request Form</a>
          <a class="nav-item nav-link " href="maintenance.html">Maintenance</a>
          <a class="nav-item nav-link " href="tracker.html">Tracker</a>
        </div>
      </div>
    </nav>
  </div>

  <br>
  <br>

  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="card card-default">
          <div class="card-header">
            Add Property
          </div>
          <div class="card-body">
            <div class="row">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">Address</th>
                    <th scope="col">City</th>
                    <th scope="col">State</th>
                    <th scope="col">Zip</th>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Phone Number</th>
                    <th scope="col">Remove</th>
                  </tr>
                </thead>
                <tbody class="add-records">
                </tbody>
              </table>
            </div>
            <div class="row">
              <div class="col-lg-6">
                <div class="card card-header">
                  Location Details
                </div>
                <div class="card card-body">
                  <form>
                    <div class="form-group">
                      <label for="addressInput">Address</label>
                      <input type="text" class="form-control" id="addressInput" placeholder="e.g. 400 S Hope St">
                    </div>
                    <div class="form-group">
                      <label for="cityInput">City</label>
                      <input type="text" class="form-control" id="cityInput" placeholder="Los Angeles">
                    </div>
                    <div class="form-group">
                      <label for="stateInput">State</label>
                      <input type="text" class="form-control" id="stateInput" placeholder="California">
                    </div>
                    <div class="form-group">
                      <label for="zipInput">Zip</label>
                      <input type="text" class="form-control" id="zipInput" placeholder="92604">
                    </div>
                  </form>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="card card-header">
                  Manager Details
                </div>
                <div class="card card-body">
                  <form>
                    <div class="form-group">
                      <label for="managerNameInput">Name</label>
                      <input type="text" class="form-control" id="managerNameInput" placeholder="e.g. John Doe">
                    </div>
                    <div class="form-group">
                      <label for="emailInput">Email</label>
                      <input type="email" class="form-control" id="emailInput" placeholder="JohnDoe@gmail.com">
                    </div>
                    <div class="form-group">
                      <label for="telInput">Phone Number</label>
                      <input type="tel" class="form-control" id="telInput" placeholder="1-214-486-8129">
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <div class="card-body">
              <button type="button" class="btn btn-primary add-property-button">Add Property</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br>
    <br>
    <div class="row">
      <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
              Issue Type
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-lg-6">
                    <div class="card" style="width: 18rem;">
                        <div class="card-header">
                          Issues Added
                        </div>
                        <ul class="list-group add-issue">
                        </ul>
                      </div>
                </div>

                <div class="col-lg-6">
                    <form>
                        <div class="form-group">
                          <label for="issueInput"></label>
                          <input type="text" class="form-control" id="issueInput" aria-describedby="issueHelp" placeholder="e.g. Plumbing">
                          <small id="issueHelp" class="form-text text-muted">Input issue type and submit</small>
                        </div>
                        <button type="submit" class="btn btn-primary add-Issue-Input-btn">Add Issue</button>
                    </form>
                </div>
              </div>
            </div>
          </div>
      </div>
    </div>

  </div>

  <!-- LINK TO FIREBASE GOES HERE -->
  <script src="https://www.gstatic.com/firebasejs/5.5.3/firebase.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <!-- Script -->
  <script type="text/javascript">

    $(document).ready(function () {

      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyBXxt23fhtW6YNk8iu_J2m9qg_ivp58RxY",
        authDomain: "property-management-aa43d.firebaseapp.com",
        databaseURL: "https://property-management-aa43d.firebaseio.com",
        projectId: "property-management-aa43d",
        storageBucket: "property-management-aa43d.appspot.com",
        messagingSenderId: "272832416557"
      };

      firebase.initializeApp(config);

      // Create a variable to reference the database.
      var database = firebase.database();

      // Initial Values
      var addressInput;
      var cityInput;
      var stateInput;
      var zipInput;

      var managerNameInput;
      var emailInput;
      var telInput;
      var contactID = 0;

      var issueInput;
      var issueInputID = 0;

// Add Property
      // Capture Button Click
      $(".add-property-button").on("click", function (event) {
        event.preventDefault();


        // Increment rownum
        contactID++;

        // Grabbed values from text boxes
        addressInput = $("#addressInput").val().trim();
        cityInput = $("#cityInput").val().trim();
        stateInput = $("#stateInput").val().trim();
        zipInput = $("#zipInput").val().trim();
        managerNameInput = $("#managerNameInput").val().trim();
        emailInput = $("#emailInput").val().trim();
        telInput = $("#telInput").val().trim();



        // Code for handling the push
        database.ref('/maintenance_contact').push({
          fb_addressInput: addressInput,
          fb_cityInput: cityInput,
          fb_stateInput: stateInput,
          fb_zipInput: zipInput,
          fb_managerNameInput: managerNameInput,
          fb_emailInput: emailInput,
          fb_telInput: telInput,
          fb_contactID: contactID
        });

        //Clear text on submission
        $("#addressInput").val("");
        $("#cityInput").val("");
        $("#stateInput").val("");
        $("#zipInput").val("");
        $("#nameInput").val("");
        $("#emailInput").val("");
        $("#telInput").val("");
        $("#managerNameInput").val("");

      });

      // Firebase watcher .on("child_added"
      database.ref('/maintenance_contact').on("child_added", function (snapshot) {
        // storing the snapshot.val() in a variable for convenience
        var sv = snapshot.val();

        contactID = sv.fb_contactID;




        // Console.loging the last user's data

        // Change the HTML to reflect
        $(".add-records").append(
          "<tr class='remove-tr'>" +
          "<td class='addressRow' row_val='" + contactID + "'>" + sv.fb_addressInput + "</td>" +
          "<td class='cityRow' row_val='" + contactID + "'>" + sv.fb_cityInput + "</td>" +
          "<td class='stateRow' row_val='" + contactID + "'>" + sv.fb_stateInput + "</td>" +
          "<td class='zipRow' row_val='" + contactID + "'>" + sv.fb_zipInput + "</td>" +
          "<td class='managerNameRow' row_val='" + contactID + "'>" + sv.fb_managerNameInput + "</td>" +
          "<td class='emailRow' row_val='" + contactID + "'>" + sv.fb_emailInput + "</td>" +
          "<td class='telRow' row_val='" + contactID + "'>" + sv.fb_telInput + "</td>" +
          "<td>" + "<button row_val='" + sv.fb_contactID + "' class='btn btn-primary remove-record'>Remove</button" + "</td>" +
          "</tr>");

        // Handle the errors
      }, function (errorObject) {
        console.log("Errors handled: " + errorObject.code);
      });

      $(document).on('click', '.remove-record', function () {

        // removes from database

        var row_val = $(this).attr('row_val')
        row_val = parseInt(row_val)

        var abc = firebase.database().ref('/maintenance_contact');
        var key_to_delete = row_val;
        var query = abc.orderByChild('fb_contactID').equalTo(key_to_delete);
        query.on('child_added', function (snapshot) {
          snapshot.ref.remove();
        });

        // removes row from front end
        $(this).closest('.remove-tr').remove()

      })

// Add Issue
      // Capture Button Click
      $(".add-Issue-Input-btn").on("click", function (event) {
        event.preventDefault();


        // Increment rownum
        issueInputID++;

        // Grabbed values from text boxes
        issueInput = $("#issueInput").val().trim();

        // Code for handling the push
        database.ref('/maintenance_issue').push({
          fb_issueInput: issueInput,
          fb_issueInputID: issueInputID
        });

        //Clear text on submission
        $("#issueInput").val("");

      });

      // Firebase watcher .on("child_added"
      database.ref('/maintenance_issue').on("child_added", function (snapshot) {
      // storing the snapshot.val() in a variable for convenience
      var sv = snapshot.val();

      issueInputID = sv.fb_issueInputID;

      // Change the HTML to reflect
      $(".add-issue").append(
      // "<tr class='remove-tr'>" +
      "<li class='issueRow list-group-item list-group-item-action' row_val='" + issueInputID + "'>" + sv.fb_issueInput + "</li>" 
      // "<td>" + "<button row_val='" + sv.fb_issueInputID + "' class='btn btn-primary remove-record'>Remove</button" + "</td>" 
      // "</tr>"
      );

      //                   // <ul class="list-group list-group-flush add-issue">
      //                   //   <li class="list-group-item">Cras justo odio</li>


      // Handle the errors
      }, function (errorObject) {
      console.log("Errors handled: " + errorObject.code);
      });

      $(document).on('click', '.issueRow', function () {

        // removes from database

        var row_val = $(this).attr('row_val')
        row_val = parseInt(row_val)

        var abc = firebase.database().ref('/maintenance_issue');
        var key_to_delete = row_val;
        var query = abc.orderByChild('fb_issueInputID').equalTo(key_to_delete);
        query.on('child_added', function (snapshot) {
          snapshot.ref.remove();
        });

        // removes row from front end
        $(this).remove()

      })
    });
  </script>

</body>

</html>